<!doctype html>
<html lang="en" ng-app="bstApp">
<head>
<meta charset="utf-8"/>
<title>Binary Tree Simulator</title>
<style>
  body { font-family: Arial, sans-serif; margin: 0px; background: #15c26b; color: #111827; }
  h1 { font-size: 30px; margin-top: 0px; margin-bottom: 0px; }
  .controls { display: flex; gap: 8px; flex-direction: column; flex-wrap: wrap; margin-bottom: 14px; margin-left: 10px;}
  input[type="number"], input[type="text"] { padding: 15px 10px; border-radius: 6px; border: 1px solid #d1d5db; width: 70%; }
  button { padding: 8px 12px; border-radius: 6px; border: none; cursor: pointer; background: #25eb88; color: white; font-weight: 600; }
  button.secondary { background: #dc2626; }
  button.warn { background: #25eb88; }
  button.undo { background: #25eb88; }
  button.redo { background: #25eb88; }
  .main-container { display: flex; gap: 12px; }
  #canvasWrap { background: white; border-radius: 8px; padding: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); height: 594px; width: 1000px; overflow: auto; }
  .output-container { width: 300px; display: flex; flex-direction: column; gap: 8px; }

  svg { width: 100%; height: 99%; }
  .edge { stroke: #9ca3af; stroke-width: 2px; }
  .node circle { fill: white; stroke: #1e293b; stroke-width: 2px; transition: 0.3s; }
  .node text { font-weight: bold; font-size: 12px; text-anchor: middle; dominant-baseline: middle; }
  .highlight circle { fill: #fde68a; stroke: #b45309; }
  .rotation circle { fill: #dbeafe; stroke: #1e3a8a; }
  .log { background: #0f172a; color: #f1f5f9; font-family: monospace; padding: 8px; height: 598px; width: 445px; overflow-y: auto; border-radius: 6px; font-size: 13px; }
  .status { padding: 6px 10px; border-radius: 6px; font-weight: 650; text-align: center; }
  .status.ok { background-color: #25eb88; color: white; }
  .status.warn { background-color: #dc2626; color: white; }

  .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: flex; justify-content: center; align-items: center; z-index: 9999; }
  .overlay-content { background: white; padding: 20px 30px; border-radius: 10px; width: 50%; max-width: 600px; text-align: left; position: relative; z-index: 10000; }
  .close-btn { position: absolute; top: 10px; right: 15px; background-color: #b40909; color: #fff; border: none; font-size: 24px; cursor: pointer; z-index: 10001; }
  .close-btn:hover { background-color: red; color: #fff; }
</style>
</head>
<body ng-controller="BstCtrl as vm">
<h1 style="background-color: #15c26b; color: #fff; padding: 15px;">
  <input type="number" ng-model="vm.inputValue" placeholder="Enter value">
  &nbsp; &nbsp; &nbsp; &nbsp;
  Binary Tree Simulator
  &nbsp; &nbsp; 
</h1>
<div class="status ok">
  Standard Binary Search Tree
</div>
<div ng-show="vm.showAbout" class="overlay">
  <div class="overlay-content">
    <h2>About Binary Tree Simulator
      <button class="close-btn" ng-click="vm.showAbout = false">&times;</button>
    </h2>
    <p>
    * Hierarchical data structure in which each node has at most two children, referred to as the left child and the right child. <br>
    * Parent-child relation of nodes. <br>
    * Forms sub-trees. <br>
    * The left child is the element usually less than the root element or the previous element. <br>
    * The right child is the element usually greater than the root element or the previous element. <br>
    </p>
  </div>
</div>
<div class="main-container">
<div class="controls">
  <br><br><br>
  <button ng-click="vm.insert()">Insert</button>
  <button class="secondary" ng-click="vm.remove()">Delete</button>
  <button class="warn" ng-click="vm.clear()">Clear</button>
  <button class="undo" ng-click="vm.undo()">Undo</button>
  <button class="redo" ng-click="vm.redo()">Redo</button>
  <button ng-click="vm.showAbout = true">About</button>
</div>

<div id="canvasWrap">
  <svg>
    <g ng-repeat="edge in vm.edges">
      <line class="edge" ng-attr-x1="{{edge.x1}}" ng-attr-y1="{{edge.y1}}" ng-attr-x2="{{edge.x2}}" ng-attr-y2="{{edge.y2}}"></line>
    </g>
    <g ng-repeat="node in vm.nodes" class="node" ng-class="{'highlight': node.highlight}" ng-attr-transform="translate({{node.x}},{{node.y}})">
      <circle r="18"></circle>
      <text>{{node.value}}</text>
    </g>
  </svg>
</div>
<div class="log">
  <div ng-repeat="line in vm.log track by $index">{{::$index + 1}}. {{line}}</div>
</div>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.3/angular.min.js"></script>
<script>
angular.module('bstApp', [])
.controller('BstCtrl', ['$scope', function($scope){
  const vm = this;
  vm.root = null;
  vm.nodes = [];
  vm.edges = [];
  vm.log = [];

  vm.undoStack = [];
  vm.redoStack = [];

  function Node(val){ this.value = val; this.left = null; this.right = null; }

  function cloneTree(node){
    if(!node) return null;
    const n = new Node(node.value);
    n.left = cloneTree(node.left);
    n.right = cloneTree(node.right);
    return n;
  }

  function insertNode(root, key){
    if(!root) return new Node(key);
    if(key < root.value) root.left = insertNode(root.left, key);
    else if(key > root.value) root.right = insertNode(root.right, key);
    return root;
  }

  function minNode(n){ while(n.left) n = n.left; return n; }

  function deleteNode(root, key){
    if(!root) return root;
    if(key < root.value) root.left = deleteNode(root.left, key);
    else if(key > root.value) root.right = deleteNode(root.right, key);
    else {
      if(!root.left) return root.right;
      if(!root.right) return root.left;
      const t = minNode(root.right);
      root.value = t.value;
      root.right = deleteNode(root.right, t.value);
    }
    return root;
  }

  function saveState(){ vm.undoStack.push(cloneTree(vm.root)); vm.redoStack = []; }

  vm.insert = function(){
    const v = Number(vm.inputValue);
    if(isNaN(v)){ vm._log('Invalid input'); return; }
    saveState();
    vm.root = insertNode(vm.root, v);
    vm._log('Inserted ' + v);
    vm.update();
  };

  vm.remove = function(){
    const v = Number(vm.inputValue);
    if(isNaN(v)){ vm._log('Invalid input'); return; }
    saveState();
    vm.root = deleteNode(vm.root, v);
    vm._log('Deleted ' + v);
    vm.update();
  };

  vm.clear = function(){
    saveState();
    vm.root = null; vm.nodes=[]; vm.edges=[];
    vm._log('Tree cleared');
    vm.update();
  };

  vm.undo = function(){
    if(vm.undoStack.length===0){ vm._log('Nothing to undo'); return; }
    vm.redoStack.push(cloneTree(vm.root));
    vm.root = vm.undoStack.pop();
    vm._log('Undo performed');
    vm.update();
  };

  vm.redo = function(){
    if(vm.redoStack.length===0){ vm._log('Nothing to redo'); return; }
    vm.undoStack.push(cloneTree(vm.root));
    vm.root = vm.redoStack.pop();
    vm._log('Redo performed');
    vm.update();
  };

  vm._log = function(msg){
    vm.log.push('['+new Date().toLocaleTimeString()+'] '+msg);
    if(vm.log.length>200) vm.log.shift();
    if(!$scope.$$phase) $scope.$applyAsync();
  };

vm.update = function(){
  vm.nodes = [];
  vm.edges = [];
  const levelH = 80;
  const canvasWidth = 1000;

  function layout(node, depth, xMin, xMax){
    if(!node) return null;

    const leftPos = layout(node.left, depth+1, xMin, xMax);
    const rightPos = layout(node.right, depth+1, xMin, xMax);

    let x;
    if(leftPos !== null && rightPos !== null) x = (leftPos + rightPos)/2;
    else if(leftPos !== null) x = leftPos + 40;
    else if(rightPos !== null) x = rightPos - 40;
    else x = (xMin + xMax)/2;

    const y = depth*levelH + 30;
    node._x = x;
    node._y = y;
    vm.nodes.push({value: node.value, x:x, y:y});

    return x;
  }

  layout(vm.root, 0, 0, canvasWidth);

  function connect(n){
    if(!n) return;
    if(n.left) vm.edges.push({x1:n._x, y1:n._y+18, x2:n.left._x, y2:n.left._y-18});
    if(n.right) vm.edges.push({x1:n._x, y1:n._y+18, x2:n.right._x, y2:n.right._y-18});
    connect(n.left);
    connect(n.right);
  }

  connect(vm.root);
};

  vm.showAbout = false;
}]);
</script>
</body>
</html>

